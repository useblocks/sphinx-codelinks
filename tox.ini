[tox]
requires =
    tox>=4.2
env_list = py{312,313,314}-sphinx{7,8,9}

[testenv]
description = Run tests with pytest
usedevelop = true
deps =
    sphinx7: sphinx>=7,<8
    sphinx8: sphinx>=8,<9
    sphinx9: sphinx>=9,<10
groups = testing
commands =
    pytest {posargs:tests}

[testenv:docs]
description = Build documentation with Sphinx
usedevelop = true
groups = docs
passenv =
    CLEAN
    BUILDER
setenv =
    BUILDER = {env:BUILDER:html}
commands_pre =
    python -c 'import os; os.system("rm -rf docs/_build/html") if os.getenv("CLEAN", "1") == "1" else None'
commands =
    sphinx-build -nW --keep-going -b {env:BUILDER} -T -c docs docs/source docs/_build/{env:BUILDER}
commands_post =
    python -c 'print("\n" + "="*60 + "\nDocumentation built successfully!\nOpen: docs/_build/{env:BUILDER}/index.html\n" + "="*60)'

[testenv:mypy]
description = Run type checking with mypy
usedevelop = true
groups = mypy
commands =
    mypy .

[testenv:ruff-check]
description = Run linting with ruff
skip_install = true
groups = ruff
commands =
    ruff check {posargs:.}

[testenv:ruff-fmt]
description = Run formatting with ruff
skip_install = true
groups = ruff
commands =
    ruff format {posargs:.}
